{% extends 'admin.html.twig' %}
{% import ':Adminlte/widget:datatable.html.twig' as datatable_util %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/js/datatables/dataTables.bootstrap.css') }}">
{% endblock %}

{% block content_header %}
    <h1>Gérer les accès</h1>
    <ol class="breadcrumb">
        <li><a href="{{ path('admin') }}"><i class="fa fa-dashboard"></i> Tableau de bord</a></li>
        <li class="active">Accès</li>
    </ol>
{% endblock content_header %}

{% block content %}
<div class="box box-solid box-red">
    <div class="box-header with-border">
        <h3 class="box-title">Accès</h3>
        <div class="box-tools pull-right">
            <a href="{{ path('ladr_security_access_new') }}" class="btn btn-sm btn-primary"><i class="glyphicon glyphicon-plus"></i> {{- 'Ajouter'|trans -}}</a>
        </div>
    </div>
    <!-- /.box-header -->
    <table id="access_datatable" class="table no-margin table-condensed table-stripped">
        <thead>
            <tr>
                <th>#</th>
                <th>Username</th>
                <th>Contact</th>
                <th>Roles</th>
                <th>Ajouté le</th>
                <th>Actif ?</th>
                <th>LogAs</th>
            </tr>
        </thead>
        <tbody>
        {% for access in accesses %}
            <tr>
                <td><a href="{{ path('ladr_security_access_edit', { 'id': access.id }) }}">{{ access.id }}</a></td>
                <td>{{ access.username }}</td>
                <td>
                    {%- if access.contact is not null %}
                        <a href="{{ path('ladr_contact_show',{ id: access.contact.id }) }}">{{ access.contact.fullName }}</a>
                    {% else %}
                        ~
                    {% endif -%}
                </td>
                <td>
                    <ul style="font-size:70%">
                        {% for role in access.roles %}
                        <li>{{ role }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>{% if access.createdAt %}{{ access.createdAt|localizeddate('medium','short') }}{% endif %}</td>
                <td>
                    {%- if access.enabled %}
                        <i class="fa fa-check text-success"></i>
                    {% else %}
                        <i class="fa fa-remove text-red"></i>
                    {% endif -%}
                </td>
                <td>
                    {% if not is_granted('ROLE_PREVIOUS_ADMIN') and app.user.id != access.id %}
                        <a href="{{ path('admin') }}?_switch_user={{ access.username }}" class="btn btn-primary btn-sm"><i class="fa fa-sign-in"></i></a>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <!-- /.box-body -->
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/js/datatables/jquery.dataTables.min.js') }}"></script>
    <script src="{{ asset('assets/js/datatables/dataTables.bootstrap.min.js') }}"></script>
    <script src="https://cdn.datatables.net/buttons/1.2.1/js/dataTables.buttons.min.js" language="javascript" type="text/javascript"></script>
    <script src="//cdn.datatables.net/buttons/1.2.1/js/buttons.flash.min.js" language="javascript" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js" language="javascript" type="text/javascript"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js" language="javascript" type="text/javascript"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js" language="javascript" type="text/javascript"></script>
    <script src="//cdn.datatables.net/buttons/1.2.1/js/buttons.html5.min.js" language="javascript" type="text/javascript"></script>
    <script src="//cdn.datatables.net/buttons/1.2.1/js/buttons.print.min.js" language="javascript" type="text/javascript"></script>
    <script type="text/javascript">


        $(function () {

            $.extend( true, $.fn.dataTable.defaults, {
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": true,
                "language": {
                    "sProcessing":     "Traitement en cours...",
                    "sSearch":         "Rechercher&nbsp;:",
                    "sLengthMenu":     "Afficher _MENU_ &eacute;l&eacute;ments",
                    "sInfo":           "Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",
                    "sInfoEmpty":      "Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ment",
                    "sInfoFiltered":   "(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",
                    "sInfoPostFix":    "",
                    "sLoadingRecords": "Chargement en cours...",
                    "sZeroRecords":    "Aucun &eacute;l&eacute;ment &agrave; afficher",
                    "sEmptyTable":     "Aucune donn&eacute;e disponible dans le tableau",
                    "oPaginate": {
                        "sFirst":      "Premier",
                        "sPrevious":   "Pr&eacute;c&eacute;dent",
                        "sNext":       "Suivant",
                        "sLast":       "Dernier"
                    },
                    "oAria": {
                        "sSortAscending":  ": activer pour trier la colonne par ordre croissant",
                        "sSortDescending": ": activer pour trier la colonne par ordre d&eacute;croissant"
                    }
                }

            } );

            $('#access_datatable').DataTable({
                dom :
                "<'box-body'" +
                "<'row'" +
                "<'col-sm-6'" +
                "l" + //[l] length changing input control
                ">" +
                "<'col-sm-6'" +
                "f" + //[f] filtering input
                ">" +
                ">" +
                "rt" + //[r] processing display element, [t] The table!
                ">" +
                "<'box-footer'" +
                "<'row'" +
                "<'col-sm-2'" +
                "B" + //[B] buttons
                ">" +
                "<'col-sm-4'" +
                "i" + //[i] Table information summary
                ">" +
                "<'col-sm-6'" +
                "p" + //[p] pagination control
                ">" +
                ">" +
                ">"
                ,
                buttons        : [
                    /*{
                        extend       : 'pdf',
                        className    : 'btn btn-primary',
                        exportOptions: {columns: ':not(.actions)'},
                        title        : 'Company'
                    },
                    {
                        extend       : 'excel',
                        className    : 'btn btn-danger',
                        exportOptions: {columns: ':not(.actions)'},
                        title        : 'Company'
                    }*/
                ],
                "paging"       : true,
                "lengthChange" : true,
                "searching"    : true,
                "ordering"     : true,
                "info"         : true,
                "autoWidth"    : true,
                "responsive"   : true,
                "lengthMenu"   : [[10, 25, 50, -1], [10, 25, 50, "{{ 'Tous'|trans }}"]],
                "pageLength"   : 10,
                "columnDefs"   : [{"targets": 'dt-ico', "orderable": false}]
            });
        });
    </script>
{% endblock javascripts %}
